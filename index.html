<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Javascript DB</title>

    <script>
      class DatabaseMap extends Map{
        name;
        proxy = new Proxy(this, {
          async get(target, prop, receiver) {
            console.log(target.name, prop);
            const response = await fetch('http://localhost:3000/op', {
              method: 'POST',
              mode: 'cors',
              cache: 'no-cache',
              credentials: 'same-origin', // include, *same-origin, omit
              headers: {
                'Content-Type': 'application/json'
              },
              redirect: 'follow', // manual, *follow, error
              referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
              body: JSON.stringify(['get',target.name, prop]) // body data type must match "Content-Type" header
            });
            return response.json(); // parses JSON response into native JavaScript objects
            // return Reflect.get(...arguments);
          }
        }) ;
        constructor(name) {
          super();
          this.name = name;
          return this.proxy;
        }
      }

      class DatabaseArray extends Array{
        name;
        proxy = new Proxy(this, {
          get(target, prop) {
            console.log(JSON.stringify([target, prop]))
            Reflect.get(...arguments)
          }
        }) ;
        constructor(name,...args) {
          super(...args);
          this.name = name;
          return this.proxy;
        }
      }

      const databaseArray = new DatabaseArray('users');
      const databaseObject = new DatabaseMap('users');

      console.log(databaseObject[1]);
      console.log(databaseObject.a);
    </script>
</head>
<body>

</body>
</html>